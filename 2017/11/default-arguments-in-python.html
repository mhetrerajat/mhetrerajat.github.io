<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Default Arguments in Python - Rajat Mhetre</title>
    <meta name="description" content="Python’s handling of default argument values is one of the few things that tends to create mistakes unknowingly (only once though).">

    <link href='https://fonts.googleapis.com/css?family=Roboto+Mono|Roboto:300,400,900,400italic' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://mhetrerajat.github.io/2017/11/default-arguments-in-python">
    <link rel="alternate" type="application/rss+xml" title="Rajat Mhetre" href="https://mhetrerajat.github.io/feed.xml">
</head>

    <body>
        <main class="u-container">
        <div class="c-page">
    <header class="c-page__header">
    <h1><code>Rajat Mhetre</code></h1>

    
    <p>
        <a href="/">Home</a><span
          class="u-separate"></span> <a href="/projects/">Projects</a><span class="u-separate"></span>&nbsp;<!--<a href="/work/">Work</a><span class="u-separate"></span>&nbsp;--><a href="/about/">About</a><span class="u-separate"></span>&nbsp;<!--<a href="/travel/">Travel</a><span class="u-separate"></span>--><a href="/feed.xml">RSS</a>
    </p>
</header>

    <div class="c-page__main">
    <article class="c-article">
    <header class="c-article__header">
        <h1 class="c-article__title">Default Arguments in Python</h1>
        <p class="c-article__time"><time datetime="2017-11-01T00:00:00+05:30" itemprop="datePublished">Nov 1, 2017</time></p>
    </header>
    
    <!-- Post Tags -->
    <ul class="c-tags">
    
      <li class="c-tag">python</li>
    
    </ul>

    <div class="c-article__main">
        <p>Python’s handling of default argument values is one of the few things that tends to create mistakes unknowingly (only once though).</p>

<p>This horror story is from my personal experience. It took me an hour to debug my silly mistake of using mutable value as default argument in function. Its really difficult to find this type bugs in thousands of lines of code.</p>

<hr />

<h2 id="using-mutable-value-as-function-argument">Using Mutable Value as function argument</h2>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">numbers</span><span class="o">=</span><span class="p">[]):</span>
	<span class="n">numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">numbers</span>
</code></pre>
</div>

<p><strong>Calling foo with argument</strong></p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">()</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="n">numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="c"># Oh Shit!</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="n">numbers</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
</code></pre>
</div>

<p><strong>Calling foo without passing argument</strong></p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;</span> <span class="n">foo</span><span class="p">()</span>
<span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="o">&gt;&gt;</span> <span class="n">foo</span><span class="p">()</span>
<span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="o">&gt;&gt;</span> <span class="n">foo</span><span class="p">()</span>
<span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span> <span class="c"># WHAT IS THIS BLACK MAGIC?</span>
</code></pre>
</div>

<hr />

<h2 id="why-does-this-happen">Why does this happen?</h2>
<p>Reason is simple, if you look at the list identity, you will see  that function keeps returning the same object:</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">foo</span><span class="p">())</span>
<span class="mi">4513595144</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">foo</span><span class="p">())</span>
<span class="mi">4513595144</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">id</span><span class="p">(</span><span class="n">foo</span><span class="p">())</span>
<span class="mi">4513595144</span>
</code></pre>
</div>

<p>Default argument values are always evaluated only when the “def” statement they belong to is executed. In Python, default arguments evaluated at definition time. This behaviour exists because of performance benefits. It’s too expensive to evaluate a function as an initialiser every time the function is called.</p>

<hr />

<h2 id="right-way-to-do-this">Right way to do this</h2>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">numbers</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="n">numbers</span> <span class="o">=</span> <span class="n">numbers</span> <span class="k">if</span> <span class="n">numbers</span> <span class="k">else</span> <span class="p">[]</span>
	<span class="n">numbers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">numbers</span>
</code></pre>
</div>

<hr />

<h2 id="some-other-cases">Some other cases</h2>
<p>In other cases, the default argument work as expected.</p>
<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
	<span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="n">count</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">()</span>
<span class="mi">1</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="mi">5</span>
</code></pre>
</div>
<p>The reason for this is not default value assignment, but in the value itself. An integer is an immutable type. Incrementing its value by doing <code class="highlighter-rouge">count += 1</code> does not change the original value of <code class="highlighter-rouge">count</code></p>

    </div>
  
    <!-- Previous / Next Buttons -->
    <div class="pagenav">
		
		
		</div>

		<!-- Disqus comments view -->
		
</article>

    </div>
    <footer class="c-page__footer">
    <p>&copy; Rajat Mhetre 2017</p>
    <p><a target="_blank" href="https://twitter.com/mhetrerajat">Twitter</a><span class="u-separate"></span><a target="_blank" href="https://github.com/mhetrerajat">Github</a><span class="u-separate"></span><a target="_blank" href="https://linkedin.com/in/mhetrerajat">Linkedin</a><span class="u-separate"></span><a target="_blank" href="https://gitlab.com/mhetrerajat">Gitlab</a></p>
</footer>

</div>

        </main>
    
      

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
        Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-109315515-1', 'auto');
  ga('send', 'pageview');
</script>



    
    </body>
</html>
